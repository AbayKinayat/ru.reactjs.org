---
title: "React v16.6.0: lazy, memo и contextType"
author: [sebmarkbage]
---

Сегодня мы релизим React 16.6 с новым удобным функционалом. Версию PureComponent/shouldComponentUpdate для функциональных компонентов, способ разделения кода при помощи Suspense и более упрощённый доступ к контексту из классовых компонентов.

<!-- Today we're releasing React 16.6 with a few new convenient features. A form of PureComponent/shouldComponentUpdate for function components, a way to do code splitting using Suspense and an easier way to consume Context from class components. -->

Полный [список изменений](#changelog) расположен ниже.

<!-- Check out the full [changelog](#changelog) below. -->

## [`React.memo`](/docs/react-api.html#reactmemo) {#reactmemo}

Классовые компоненты могут прекратить рендеринг, когда их пропсы неизменны при помощи [`PureComponent`](/docs/react-api.html#reactpurecomponent) или [`shouldComponentUpdate`](/docs/react-component.html#shouldcomponentupdate). Теперь то же самое можно сделать и в функциональных компонентах, если обернуть их в [`React.memo`](/docs/react-api.html#reactmemo).

<!-- Class components can bail out from rendering when their input props are the same using [`PureComponent`](/docs/react-api.html#reactpurecomponent) or [`shouldComponentUpdate`](/docs/react-component.html#shouldcomponentupdate). Now you can do the same with function components by wrapping them in [`React.memo`](/docs/react-api.html#reactmemo). -->

```js
const MyComponent = React.memo(function MyComponent(props) {
  /* повторный рендер пройдёт только при изменении пропсов */
});
```

## [`React.lazy`](/docs/code-splitting.html#reactlazy): Разделение кода при помощи `Suspense` {#reactlazy-code-splitting-with-suspense}

<!-- ## [`React.lazy`](/docs/code-splitting.html#reactlazy): Code-Splitting with `Suspense` {#reactlazy-code-splitting-with-suspense} -->

Возможно, вы уже видели [доклад Дэна о React Suspense(задержке) на JSConf Iceland](/blog/2018/03/01/sneak-peek-beyond-react-16.html). Теперь вы можете использовать компонент Suspense для [разделения кода](/docs/code-splitting.html#reactlazy) - достаточно поместить динамический импорт в вызов `React.lazy()`.

<!-- You may have seen [Dan's talk about React Suspense at JSConf Iceland](/blog/2018/03/01/sneak-peek-beyond-react-16.html). Now you can use the Suspense component to do [code-splitting](/docs/code-splitting.html#reactlazy) by wrapping a dynamic import in a call to `React.lazy()`. -->

```js
import React, {lazy, Suspense} from 'react';
const OtherComponent = lazy(() => import('./OtherComponent'));

function MyComponent() {
  return (
    <Suspense fallback={<div>Загрузка...</div>}>
      <OtherComponent />
    </Suspense>
  );
}
```

Компонент Suspense также даст возможность авторам библиотек в --дальшнейшем спроектировать-- подгрузку данных с задержкой.

<!-- The Suspense component will also allow library authors to start building data fetching with Suspense support in the future. -->

> Примечание: этот функционал пока не доступен для серверного рендеринга. Задержка будет добавлена более позднем релизе.

<!-- > Note: This feature is not yet available for server-side rendering. Suspense support will be added in a later release. -->

## [`static contextType`](/docs/context.html#classcontexttype) {#static-contexttype}

В [React 16.3](/blog/2018/03/29/react-v-16-3.html) мы представили официальный API для контекста, который заменит [устаревший API контекста](/docs/legacy-context.html).

<!-- In [React 16.3](/blog/2018/03/29/react-v-16-3.html) we introduced the official Context API as a replacement to the previous [Legacy Context](/docs/legacy-context.html) API. -->

```js
const MyContext = React.createContext();
```

Мы учли замечания по поводу сложностей работы с API на основе рендер-пропсов и добавили удобный API для получения значений контекста из классовых компонентов.

<!-- We've heard feedback that adopting the new render prop API can be difficult in class components. So we've added a convenience API to [consume a context value from within a class component](/docs/context.html#classcontexttype). -->

```js
class MyClass extends React.Component {
  static contextType = MyContext;
  componentDidMount() {
    let value = this.context;
    /* perform a side-effect at mount using the value of MyContext */
  }
  componentDidUpdate() {
    let value = this.context;
    /* ... */
  }
  componentWillUnmount() {
    let value = this.context;
    /* ... */
  }
  render() {
    let value = this.context;
    /* render something based on the value of MyContext */
  }
}
```

## [`static getDerivedStateFromError()`](/docs/react-component.html#static-getderivedstatefromerror) {#static-getderivedstatefromerror}

React 16 впервые представил [предохранители](/blog/2017/07/26/error-handling-in-react-16.html) - механизм обработки ошибок, выброшенных при рендере. У нас уже был метод жизненного цикла, вызываемый после возникновения ошибок - `componentDidCatch` - он отлично подходил для отправки логов ошибок на сервер. Также с его помощью можно вызвать `setState` и показать другой интерфейс.

<!-- React 16 introduced [Error Boundaries](/blog/2017/07/26/error-handling-in-react-16.html) for handling errors thrown in React renders. We already had the `componentDidCatch` lifecycle method which gets fired after an error has already happened. It's great for logging errors to the server. It also lets you show a different UI to the user by calling `setState`. -->

До его вызова мы рендерим `null` в точке дерева, где произошла ошибка. Иногда родительские компоненты бывают не готовы к исчезновению рефов на дочерние компоненты и ломаются. Восстановиться после ошибки на сервере также нельзя, потому что `Did`-методы жизненного цикла не вызываются при серверном рендере.

<!-- Before that is fired, we render `null` in place of the tree that threw an error. This sometimes breaks parent components that don't expect their refs to be empty. It also doesn't work to recover from errors on the server since the `Did` lifecycle methods don't fire during server-side rendering. -->

Мы добавили новый метод для рендера запасного интерфейса до того, как завершится полный рендер. Документация [тут](/docs/react-component.html#static-getderivedstatefromerror).

<!-- We're adding another error method that lets you render the fallback UI before the render completes. See the docs for [`getDerivedStateFromError()`](/docs/react-component.html#static-getderivedstatefromerror). -->

> Примечание: `getDerivedStateFromError()` пока не доступен для серверного рендера. Мы выпустили его в таком виде, чтобы вы освоились и подготовились к релизу, в котором метод заработает и на сервере.

<!-- > Note: `getDerivedStateFromError()` is not yet available for server-side rendering. It is designed to work with server-side rendering in a future release. We're releasing it early so that you can start preparing to use it. -->

## Устаревшие API для StrictMode {#deprecations-in-strictmode}

<!-- ## Deprecations in StrictMode {#deprecations-in-strictmode} -->

В [версии 16.3](/blog/2018/03/29/react-v-16-3.html#strictmode-component) мы представили компонент [`StrictMode`](/docs/strict-mode.html), который выводит предупреждения при использовании конструкций, которые могут вызвать проблемы в будущем.

<!-- In [16.3](/blog/2018/03/29/react-v-16-3.html#strictmode-component) we introduced the [`StrictMode`](/docs/strict-mode.html) component. It lets you opt-in to early warnings for patterns that might cause problems in the future. -->

Мы добавили ещё два API в список устаревших API `StrictMode`. Если вы не используете `StrictMode`, то не беспокойтесь -- эти предупреждения у вас не выскочат.

<!-- We've added two more APIs to the list of deprecated APIs in `StrictMode`. If you don't use `StrictMode` you don't have to worry; these warning won't fire for you. -->

* __ReactDOM.findDOMNode()__ -- этот API был неправильно понят и пригождается очень редко. И ещё он может сильно тормозить в React 16. В [документации](/docs/strict-mode.html#warning-about-deprecated-finddomnode-usage) мы описали, как можно отойти от его использования.
* __Legacy Context__ -- contextTypes и getChildContext немного замедляют React и делают его более громоздким. Так что мы настоятельно рекомендуем вам обновиться до [нового API контекста](/docs/context.html). Мы надеемся, что новый API [`contextType`](/docs/context.html#classcontexttype) упростит обновление.

<!-- * __ReactDOM.findDOMNode()__ - This API is often misunderstood and most uses of it are unnecessary. It can also be surprisingly slow in React 16. [See the docs](/docs/strict-mode.html#warning-about-deprecated-finddomnode-usage) for possible upgrade paths. -->
<!-- * __Legacy Context__ using contextTypes and getChildContext - Legacy context makes React slightly slower and bigger than it needs to be. That's why we strongly want to encourage upgrading to the [new context API](/docs/context.html). Hopefully the addition of the [`contextType`](/docs/context.html#classcontexttype) API makes this a bit easier. -->

Если у вас возникнут трудности с обновлением, пожалуйста, дайте нам знать.

<!-- If you're having trouble upgrading, we'd like to hear your feedback. -->

## Установка {#installation}

<!-- ## Installation {#installation} -->

React v16.6.0 уже доступен в реестре npm.

Чтобы установить React 16 через yarn, запустите:

```bash
yarn add react@^16.6.0 react-dom@^16.6.0
```

Чтобы установить React 16 через npm, запустите:

```bash
npm install --save react@^16.6.0 react-dom@^16.6.0
```

Мы также даём возможность скачивать UMD-билды React через CDN:

<!-- React v16.6.0 is available on the npm registry.

To install React 16 with Yarn, run:

```bash
yarn add react@^16.6.0 react-dom@^16.6.0
```

To install React 16 with npm, run:

```bash
npm install --save react@^16.6.0 react-dom@^16.6.0
```

We also provide UMD builds of React via a CDN:

```html
<script crossorigin src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>
``` 

Refer to the documentation for [detailed installation instructions](/docs/installation.html).
-->

## Список изменений {#changelog}

<!-- ## Changelog {#changelog} -->

### React {#react}

* Добавить `React.memo()` как альтернативу `PureComponent` для функций. ([@acdlite](https://github.com/acdlite) в [#13748](https://github.com/facebook/react/pull/13748))
* Добавить `React.lazy()` для компонентов с разделением кода. ([@acdlite](https://github.com/acdlite) в [#13885](https://github.com/facebook/react/pull/13885))
* `React.StrictMode` теперь предупреждает об устаревшем API контекста. ([@bvaughn](https://github.com/bvaughn) в [#13760](https://github.com/facebook/react/pull/13760))
* `React.StrictMode` теперь предупреждает о `findDOMNode`. ([@sebmarkbage](https://github.com/sebmarkbage) в [#13841](https://github.com/facebook/react/pull/13841))
* Переименовать `unstable_AsyncMode` в `unstable_ConcurrentMode`. ([@trueadm](https://github.com/trueadm) в [#13732](https://github.com/facebook/react/pull/13732))
* Переименовать `unstable_Placeholder` в `Suspense` и `delayMs` -- в `maxDuration`. ([@gaearon](https://github.com/gaearon) в [#13799](https://github.com/facebook/react/pull/13799) и [@sebmarkbage](https://github.com/sebmarkbage) в [#13922](https://github.com/facebook/react/pull/13922))

<!-- * Add `React.memo()` as an alternative to `PureComponent` for functions. ([@acdlite](https://github.com/acdlite) in [#13748](https://github.com/facebook/react/pull/13748))
* Add `React.lazy()` for code splitting components. ([@acdlite](https://github.com/acdlite) in [#13885](https://github.com/facebook/react/pull/13885))
* `React.StrictMode` now warns about legacy context API. ([@bvaughn](https://github.com/bvaughn) in [#13760](https://github.com/facebook/react/pull/13760))
* `React.StrictMode` now warns about `findDOMNode`. ([@sebmarkbage](https://github.com/sebmarkbage) in [#13841](https://github.com/facebook/react/pull/13841))
* Rename `unstable_AsyncMode` to `unstable_ConcurrentMode`. ([@trueadm](https://github.com/trueadm) in [#13732](https://github.com/facebook/react/pull/13732))
* Rename `unstable_Placeholder` to `Suspense`, and `delayMs` to `maxDuration`. ([@gaearon](https://github.com/gaearon) in [#13799](https://github.com/facebook/react/pull/13799) and [@sebmarkbage](https://github.com/sebmarkbage) in [#13922](https://github.com/facebook/react/pull/13922)) -->

### React DOM {#react-dom}

* Добавить  более удобный способ подписки на контект из классов -- `contextType`. ([@bvaughn](https://github.com/bvaughn) в [#13728](https://github.com/facebook/react/pull/13728))
* Добавить метод жизненного цикла для отлова ошибок в будущем асинхронном серверном рендерере `getDerivedStateFromError`. ([@bvaughn](https://github.com/bvaughn) in [#13746](https://github.com/facebook/react/pull/13746))
* Выводить предупреждение, когда вместо `<Context.Consumer>` используется `<Context>`. ([@trueadm](https://github.com/trueadm) в [#13829](https://github.com/facebook/react/pull/13829))
* Пофиксить серый оверлей в iOS Safari. ([@philipp-spiess](https://github.com/philipp-spiess) в [#13778](https://github.com/facebook/react/pull/13778))
* Пофиксить баг, вызванный перезаписью `window.event` в режиме разработки. ([@sergei-startsev](https://github.com/sergei-startsev) в [#13697](https://github.com/facebook/react/pull/13697))

### React DOM Server {#react-dom-server}

* Добавить поддержку `React.memo()`. ([@alexmckenley](https://github.com/alexmckenley) в [#13855](https://github.com/facebook/react/pull/13855))
* Добавить поддержку `contextType`. ([@alexmckenley](https://github.com/alexmckenley) и [@sebmarkbage](https://github.com/sebmarkbage) в [#13889](https://github.com/facebook/react/pull/13889))

### Планировщик (экспериментальный) {#scheduler-experimental}

<!-- ### Scheduler (Experimental) {#scheduler-experimental} -->

* Переименовать пакет в `scheduler`. ([@gaearon](https://github.com/gaearon) в [#13683](https://github.com/facebook/react/pull/13683))
* Добавить поддержку уровней приоритета, продолжений и обёрнутых колбэков. ([@acdlite](https://github.com/acdlite) в [#13720](https://github.com/facebook/react/pull/13720) and [#13842](https://github.com/facebook/react/pull/13842))
* Улучшить механизм запасного планировщика в среде без DOM. ([@acdlite](https://github.com/acdlite) в [#13740](https://github.com/facebook/react/pull/13740))
* Назначить `requestAnimationFrame` выполняться раньше. ([@acdlite](https://github.com/acdlite) в [#13785](https://github.com/facebook/react/pull/13785))
* Добавить более тщательную проверку на наличие DOM. ([@trueadm](https://github.com/trueadm) в [#13731](https://github.com/facebook/react/pull/13731))
* Пофиксить баги счётчика взамодействий. ([@bvaughn](https://github.com/bvaughn) в [#13590](https://github.com/facebook/react/pull/13590))
* Добавить в пакет `envify`-трансформацию кода. ([@mridgway](https://github.com/mridgway) in [#13766](https://github.com/facebook/react/pull/13766))

<!-- * Rename the package to `scheduler`. ([@gaearon](https://github.com/gaearon) in [#13683](https://github.com/facebook/react/pull/13683))
* Support priority levels, continuations, and wrapped callbacks. ([@acdlite](https://github.com/acdlite) in [#13720](https://github.com/facebook/react/pull/13720) and [#13842](https://github.com/facebook/react/pull/13842))
* Improve the fallback mechanism in non-DOM environments. ([@acdlite](https://github.com/acdlite) in [#13740](https://github.com/facebook/react/pull/13740))
* Schedule `requestAnimationFrame` earlier. ([@acdlite](https://github.com/acdlite) in [#13785](https://github.com/facebook/react/pull/13785))
* Fix the DOM detection to be more thorough. ([@trueadm](https://github.com/trueadm) in [#13731](https://github.com/facebook/react/pull/13731))
* Fix bugs with interaction tracing. ([@bvaughn](https://github.com/bvaughn) in [#13590](https://github.com/facebook/react/pull/13590))
* Add the `envify` transform to the package. ([@mridgway](https://github.com/mridgway) in [#13766](https://github.com/facebook/react/pull/13766)) -->
