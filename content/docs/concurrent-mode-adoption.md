---
id: concurrent-mode-adoption
title: Знакомство с конкурентным режимом
permalink: docs/concurrent-mode-adoption.html
prev: concurrent-mode-patterns.html
next: concurrent-mode-reference.html
---

>Предупреждение:
>
>В этом разделе описаны **экспериментальные функции, которые пока ещё недоступны в стабильном релизе**. Не стоит использовать экспериментальные сборки React в приложениях, находящихся в эксплуатации. Прежде чем стать частью React, экспериментальные функции могут претерпеть значительные изменения, которые происходят без предупреждений.
>
>Данный раздел документации предназначен для альфа тестеров и для просто любопытных пользователей. Если вы новичок в React, не стоит уделять особое внимание экспериментальным функциям. У вас нет необходимости изучать их прямо сейчас.

- [Установка](#installation)
  - [Для кого предназначены экспериментальные релизы?](#who-is-this-experimental-release-for)
  - [Включение конкурентного режима](#enabling-concurrent-mode)
- [К чему готовиться?](#what-to-expect)
  - [Промежуточный этап: блокирующий режим](#migration-step-blocking-mode)
  - [Зачем столько режимов?](#why-so-many-modes)
  - [Сравнение режимов](#feature-comparison)

## Установка {#installation}

Конкурентный режим доступен только в [экспериментальных сборках](/blog/2019/10/22/react-release-channels.html#experimental-channel) React. Чтобы установить текущую экспериментальную сборку, запустите команду:

```text
npm install react@experimental react-dom@experimental
```

**Для экспериментальных сборок семантическое версионирование не ведется.**

В любом следующем релизе с версией `@experimental` функции API могут быть добавлены, изменены или удалены.

**Экспериментальные релизы часто имеют калечащие изменения.**

Вы можете пробовать такие сборки в личных проектах или для экспериментальных веток, однако мы не рекомендуем использовать их в продакшен-релизах. В Facebook мы *используем* их в продакшен, но только потому, что у нас есть возможность оперативно исправлять ошибки, если что-то сломается.

### Для кого предназначены экспериментальные релизы? {#who-is-this-experimental-release-for}

Экспериментальные релизы, в основном, предназначены для альфа тестеров, разработчиков библиотек или для любопытных пользователей.

Мы используем экспериментальный код в продакшен (в нашем случае его можно считать работоспособным), несмотря на то, что в нем есть некоторое количество ошибок, недоделанные функции и пробелы в документации. Мы хотим выявить как можно больше проблемных моментов в работе конкурентного режима и в будущем лучше подготовить его к выпуску официального стабильного релиза.

### Включение конкурентного режима {#enabling-concurrent-mode}

Обычно, когда мы добавляем новые возможности в React, вы можете сразу же использовать их. Например, фрагменты, контекст и даже хуки были именно такими. Их можно использовать в новом коде не меняя уже существующий.

С конкурентным режимом другая история. В нём изменена сама суть работы React. Без этого *не было бы возможности* задействовать новые [функции](/docs/concurrent-mode-patterns.html) и именно по этой причине они объединены в новый "режим", а не выпускаются по-отдельности.

Вы не можете использовать конкурентный режим для отдельных поддеревьев. Включать конкурентный режим нужно в том же месте, где ранее вы вызывали функцию `ReactDOM.render()`.

**Например, данный код позволяет включить конкурентный режим для всего дерева тега `<App />`:**

```js
import ReactDOM from 'react-dom';

// Раньше вы использовали:
//
// ReactDOM.render(<App />, document.getElementById('root'));
//
// Теперь для перехода в конкурентный режим нужно написать:

ReactDOM.createRoot(
  document.getElementById('root')
).render(<App />);
```

>Примечание:
>
>Функции API конкурентного режима доступны только в экспериментальных сборках React.

В конкурентном режиме методы жизненного цикла, [ранее помеченные](https://reactjs.org/blog/2018/03/27/update-on-async-rendering.html) как "небезопасные", *становятся* действительно небезопасными и приводят к ошибкам гораздо чаще, чем в текущих релизах React. Если вы используете при разработке [строгий режим](https://reactjs.org/docs/strict-mode.html), то мы не рекомендуем пробовать конкурентный режим в то время, когда `StrictMode` задействован.

## К чему готовиться? {#what-to-expect}

Если у вас достаточно большое приложение или в нём много зависимостей от пакетов сторонних разработчиков, не стоит надеяться, что вы сможете перейти на конкурентный режим быстро. **Например, в Facebook мы используем конкурентный режим только на новых сайтах и не планируем задействовать его на старых, разработанных ранее, сайтах.** Всё это из-за того, что старые сайты в продакшен коде используют небезопасные методы жизненного цикла, несовместимые библиотеки сторонних разработчиков и паттерны, которые плохо работают в конкурентном режиме.

Наш опыт показывает, что код, который использует классические паттерны React и не зависит от решений, подразумевающих внешнее управление состоянием, будет проще заставить работать в конкурентном режиме. В ближайшее время мы опишем проблемы, которые смогли обнаружить, и способы их решения.

### Промежуточный этап: блокирующий режим {#migration-step-blocking-mode}

Для старых проектов путь перехода на конкурентный режим может оказаться достаточно длинным. Поэтому в экспериментальных сборках React мы предусмотрели новый "блокирующий режим". Вы можете попробовать его, заменив `createRoot` на `createBlockingRoot`. Блокирующий режим предоставляет *сокращённый набор* возможностей конкурентного режима. При этом он ближе к тому, как работает React в настоящее время, и может послужить в качестве промежуточного этапа.

Итого:

* **Старый режим:** `ReactDOM.render(<App />, rootNode)`. Это режим, в котором React работает в настоящее время. В обозримом будущем мы не планируем избавляться от старого режима, но он не будет поддерживать новые возможности.
* **Блокирующий режим:** `ReactDOM.createBlockingRoot(rootNode).render(<App />)`. Это режим, который сейчас является экспериментальным. Он предназначен в качестве первого этапа миграции приложений, в которых предполагается использовать некоторые возможности конкурентного режима.
* **Конкурентный режим:** `ReactDOM.createRoot(rootNode).render(<App />)`. режим является экспериментальным. В будущем, после стабилизации, мы намерены сделать его основным режимом React. Данный режим задействует *все* новые возможности.

### Зачем столько режимов? {#why-so-many-modes}

Мы считаем, что стратегия постепенного развития [с ответственным отношением к стабильности](/docs/faq-versioning.html#commitment-to-stability) лучше, чем резкие скачкообразные изменения или полное отсутствие развития.

На практике мы ожидаем, что большинство приложений, использующих в настоящее время старый режим, смогут перейти на конкурентный или, как минимум, на блокирующий. Такая фрагментация может создать некоторые проблемы для авторов библиотек, которые будут вынуждены какое-то время поддерживать все режимы. Однако нужно учитывать, что постепенный переход со старого режима помогает решать проблемы, влияющие на основные библиотеки в экосистеме React, например, [странное поведение Задержек при чтении DOM](https://github.com/facebook/react/issues/14536) и [нестабильность пакетного рендеринга](https://github.com/facebook/react/issues/15080). Есть некоторое количество багов, которые невозможно исправить без изменения семантики в старом режиме, но при этом они отсутствуют в блокирующем или конкурентном режимах.

Вы можете рассматривать блокирующий режим как "отказоустойчивую" версию конкурентного режима. **В конечном итоге, в долгосрочной перспективе, у нас будет возможность объединить оба режима и перестать рассматривать их как отдельные друг от друга.** В настоящее время режимы являются важной частью переходной стратегии. Они дают возможность каждому определять момент перехода на конкурентный режим и обновлять код в удобном для себя темпе.

### Сравнение возможностей {#feature-comparison}

<style>
  #feature-table table { border-collapse: collapse; }
  #feature-table th { padding-right: 30px; }
  #feature-table tr { border-bottom: 1px solid #eee; }
</style>

<div id="feature-table">

|   |Старый режим  |Блокирующий режим  |Конкурентный режим  |
|:---  |:---:  |:---:  |:---:  |
|Строковые рефы  |✅  |🚫**  |🚫**  |
|Старый контекст |✅  |🚫**  |🚫**  |
|findDOMNode  |✅  |🚫**  |🚫**  |
|Задержка |✅  |✅  |✅  |
|SuspenseList |🚫  |✅  |✅  |
|Задержка в React на сервере + гидратация |🚫  |✅  |✅  |
|Последовательная гидратация  |🚫  |✅  |✅  |
|Выборочная гидратация  |🚫  |🚫  |✅  |
|Кооперативная многозадачность |🚫  |🚫  |✅  |
|Автоматическая группировка при множественном вызове setStates     |🚫* |✅  |✅  |
|Приоритетный рендеринг |🚫  |🚫  |✅  |
|Прерываемый предварительный рендеринг |🚫  |🚫  |✅  |
|useTransition  |🚫  |🚫  |✅  |
|useDeferredValue |🚫  |🚫  |✅  |
|Периодические задержки типа "Train"  |🚫  |🚫  |✅  |

</div>

\*: Страрый режим имеет автоматический пакетный рендеринг для обрабатываемых React событий, но он ограничен одним потоком браузера. Для алтернативных рендереров должен быть установлен `unstable_batchedUpdates`. В блокирующем и конкурентном режимах все вызовы `setState` группируются для пакетного рендеринга по-умолчанию.

\*\*: Предупреждения в режиме разработки.
